/*! module-utils 2014-05-05 */
;function ElementStore(){}ElementStore.prototype={_cache:null,config:null,_document:null,returnNative:false,_root:null,constructor:ElementStore,init:function init(a){if(!a){throw new Error("Missing required argument: root")}this.config=this.config||{elements:{},collections:{}};this._cache={};this.setRoot(a);if(!this.createElement){this.createElement=this._createElement}if(!this.parseHTML){this.parseHTML=this._parseHTML}if(!this.querySelector){this.querySelector=this._querySelector}if(!this.querySelectorAll){this.querySelectorAll=this._querySelectorAll}this.eagerLoad();return this},destructor:function destructor(){if(this._cache){this.clearCache();this._cache=null}this.config=this._root=this._document=null},clearCache:function clearCache(){var a;for(a in this._cache){if(this._cache.hasOwnProperty(a)){this._cache[a]=null}}return this},_createElement:function _createElement(a){return this._document.createElement(a)},eagerLoad:function eagerLoad(){var b,a;for(b in this.config.elements){if(this.config.elements.hasOwnProperty(b)){a=this.config.elements[b];if(a.eager&&!a.nocache){this._cache[b]=this.getElement(b)}}}for(b in this.config.collections){if(this.config.collections.hasOwnProperty(b)){a=this.config.collections[b];if(a.eager&&!a.nocache){this.getCollection(b)}}}return this},get:function get(a){return this.getElement(a)||this.getCollection(a)||null},getCollection:function getCollection(a){var b;if(!this.config.collections[a]){b=null}else{if(this._cache[a]){b=this._cache[a]}else{if(this.config.collections[a].selector){b=this.querySelectorAll(this.config.collections[a].selector);if(!this.config.collections[a].nocache){this._cache[a]=b}}else{throw new Error('Missing required config "selector" for collection '+a)}}}return b},getElement:function getElement(b){var a;if(!this.config.elements[b]){a=null}else{if(this._cache[b]){a=this._cache[b]}else{if(this.config.elements[b].selector){a=this.querySelector(this.config.elements[b].selector);if(!this.config.elements[b].nocache){this._cache[b]=a}}else{throw new Error('Missing required config "selector" for element '+b)}}}return a},isCollection:function isCollection(a){return this.config.collections.hasOwnProperty(a)},isElement:function isElement(a){return this.config.elements.hasOwnProperty(a)},keys:function keys(){var b=[],a;for(a in this.config.elements){if(this.config.elements.hasOwnProperty(a)){b.push(a)}}for(a in this.config.collections){if(this.config.collections.hasOwnProperty(a)){b.push(a)}}return b},_mergeConfigs:function _mergeConfigs(a,c,b){for(key in c){if(c.hasOwnProperty(key)&&(a[key]===undefined||!b)){a[key]=c[key]}}},_parseHTML:function _parseHTML(b){b=b.replace(/^\s+|\s+$/g,"");var d=this.createElement("div");d.innerHTML=b;var c=[],a=d.childNodes.length;while(a--){c.push(d.childNodes[a]);d.removeChild(d.childNodes[a])}d=null;return c},setConfig:function setConfig(b,a){this.config=this.config||{elements:{},collections:{}};if(b.elements){this._mergeConfigs(this.config.elements,b.elements,a)}if(b.collections){this._mergeConfigs(this.config.collections,b.collections,a)}return this},setRoot:function setRoot(a){this.clearCache();this._root=a;this._document=this._root.nodeName==="#document"?this._root:this._root.ownerDocument;return this},toString:function toString(){return"[object ElementStore]"},_querySelector:function _querySelector(a,b){return(b||this._root).querySelector(a)},_querySelectorAll:function _querySelectorAll(a,b){return(b||this._root).querySelectorAll(a)}};ElementStore.Utils={prototype:{elementStore:{},destroyElementStore:function destroyElementStore(){if(this.elementStore){this.elementStore.destructor();this.elementStore=null}},initElementStore:function initElementStore(a){if(!this.hasOwnProperty("elementStore")){this.elementStore=new ElementStore()}this._compileElementStore();this._initGetters();this.elementStore.init(a)},_initGetters:function _initGetters(){if(this.__proto__.hasOwnProperty("__elementStoreGettersCreated__")){return}var b,a,d=this.__proto__;var e=this.elementStore.config.elements;var c=this.elementStore.config.collections;if(!this.createElementGetter){this.createElementGetter=this._createElementGetter}if(!this.createCollectionGetter){this.createCollectionGetter=this._createCollectionGetter}for(b in e){if(e.hasOwnProperty(b)){if(!d[b]){a=b}else{if(!d[b+"Element"]){a=b+"Element"}else{throw new Error("Cannot create element getter: "+b)}}this.createElementGetter(b,a)}}for(b in c){if(c.hasOwnProperty(b)){if(!d[b]){a=b}else{if(!d[b+"Collection"]){a=b+"Collection"}else{throw new Error("Cannot create collection getter: "+b)}}this.createCollectionGetter(b,a)}}d.__elementStoreGettersCreated__=true;e=c=d=null},clearElementStoreCache:function clearElementStoreCache(){this.elementStore.clearCache()},collection:function collection(a){return this.elementStore.getCollection(a)},_compileElementStore:function _compileElementStore(){if(this.__proto__.hasOwnProperty("_compiledElementStore")){this.elementStore.setConfig(this.__proto__._compiledElementStore);return}var a=this.__proto__;while(a){if(a.hasOwnProperty("elementStore")){this.elementStore.setConfig(a.elementStore,true)}a=a.__proto__}this.__proto__._compiledElementStore=this.elementStore.config},_createCollectionGetter:function _createCollectionGetter(c,b){var a=function d(){return this.elementStore.getCollection(c)};this.__proto__[b]=a},_createElementGetter:function _createElementGetter(c,b){var a=function d(){return this.elementStore.getElement(c)};this.__proto__[b]=a},element:function element(a){return this.elementStore.getElement(a)}}};Module.Utils.ElementStore={includes:[ElementStore.Utils],included:function(a){a.addCallback("beforeReady","_initElementStore");a.addCallback("destroy","destroyElementStore")},prototype:{_initElementStore:function _initElementStore(){this.initElementStore(this.element)}}};Module.Utils.include(Module.Utils.ElementStore);